<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTML module - 2 | Learning Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="https://ai-public.creatie.ai/gen_page/tailwind-custom.css" rel="stylesheet" />
    <script
        src="https://cdn.tailwindcss.com/3.4.5?plugins=forms@0.5.7,typography@0.5.13,aspect-ratio@0.4.2,container-queries@0.1.1"></script>
    <script src="https://ai-public.creatie.ai/gen_page/tailwind-config.min.js" data-color="#2563EB"
        data-border-radius="small"></script>
</head>

<body class="bg-gray-50 font-[&#39;Inter&#39;]">
    <div class="min-h-screen flex flex-col">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex">
                        <div class="flex-shrink-0 flex items-center">
                            <img class="h-8 w-auto" src="https://ai-public.creatie.ai/gen_page/logo_placeholder.png"
                                alt="Logo" />
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="flex items-center space-x-4">
                            <a href="./community.html" class="text-blue-600 hover:text-blue-800 font-medium flex items-center">
                                <i class="fas fa-comments mr-2"></i>
                                Community
                            </a>
                            <span class="text-sm text-gray-500">Progress: 1/6 Topics</span>
                            <div class="w-32 h-2 bg-gray-200 rounded-full">
                                <div class="w-1/6 h-2 bg-blue-600 rounded-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <div class="flex-1 flex">
            <main class="flex-1 overflow-y-auto bg-white p-8">
                <div class="max-w-8xl mx-auto">
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-gray-900">HTML module - 2</h1>
                        <p class="mt-2 text-gray-600">Introduction to HTML basics and fundamentals</p>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold">Getting Started with HTML</h2>
                            <button class="!rounded-button px-4 py-2 bg-white text-blue-600 border border-blue-600 hover:bg-blue-50 shadow-sm opacity-50 cursor-not-allowed" disabled>
                                <i class="fas fa-check mr-2"></i>
                                Mark as Complete
                            </button>
                        </div>
                        <div class="aspect-w-16 aspect-h-9 mb-6">
                            <iframe id="video-player" class="rounded-lg"
                                src="https://www.youtube.com/embed/Yh9OXmldCIY?enablejsapi=1" allowfullscreen></iframe>
                        </div>
                        <div class="prose max-w-none">
                            <p>HTML (HyperText Markup Language) is the standard markup language for documents designed
                                to be displayed in a web browser. It defines the structure and layout of a web document.
                            </p>
                            <h3 class="text-lg font-semibold mt-6 mb-3">Key Concepts:</h3>
                            <ul class="list-disc pl-6 space-y-2">
                                <li>HTML Elements and Tags</li>
                                <li>Document Structure</li>
                                <li>Basic Text Formatting</li>
                                <li>Links and Images</li>
                            </ul>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                        <h3 class="text-lg font-semibold mb-4">Assignment - 1</h3>
                        <p class="text-gray-600 mb-6">Create a simple HTML page that includes a heading, paragraph, and
                            an image. Submit your code below.</p>
                        <button
                            class="!rounded-button bg-blue-600 text-white px-6 py-2 font-medium hover:bg-blue-700 transition-colors">
                            Start Assignment
                        </button>
                    </div>
                </div>
            </main>
            <aside class="w-80 border-l border-gray-200 bg-white overflow-y-auto">
                <div class="p-6">
                    <h2 class="text-lg font-semibold mb-4">Module Topics</h2>
                    <div class="space-y-2">
                        <button class="!rounded-button w-full text-left px-4 py-3 bg-blue-600 text-white">
                            <div class="flex items-center">
                                <span class="flex-1">1. Introduction to HTML</span>
                            </div>
                        </button>
                        <button
                            class="!rounded-button w-full text-left px-4 py-3 bg-gray-100 text-gray-700 hover:bg-blue-50 active:bg-blue-600 active:text-white">
                            2. HTML Elements
                        </button>
                        <button
                            class="!rounded-button w-full text-left px-4 py-3 bg-gray-100 text-gray-700 hover:bg-blue-50">
                            3. Text Formatting
                        </button>
                        <button
                            class="!rounded-button w-full text-left px-4 py-3 bg-gray-100 text-gray-700 hover:bg-blue-50">
                            4. Links and Images
                        </button>
                        <button
                            class="!rounded-button w-full text-left px-4 py-3 bg-gray-100 text-gray-700 hover:bg-blue-50">
                            5. Lists and Tables
                        </button>
                        <button
                            class="!rounded-button w-full text-left px-4 py-3 bg-gray-100 text-gray-700 hover:bg-blue-50">
                            6. Forms and Input
                        </button>
                    </div>
                </div>
            </aside>
        </div>
        <footer class="bg-white border-t border-gray-200">
            <div class="max-w-8xl mx-auto px-4 py-4 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button class="!rounded-button px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50"
                        onclick="location.href='modulespage.html'">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Previous
                    </button>
                    <button class="!rounded-button px-4 py-2 bg-blue-600 text-white hover:bg-blue-700">
                        Next
                        <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
        </footer>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const buttons = document.querySelectorAll("aside button");
            const iframe = document.querySelector("iframe");
            let currentVideoIndex = 0;
            let currentProgress = 0;
            let completedTopics = JSON.parse(localStorage.getItem('completedTopics')) || [];

            // Mapping topics to video URLs
            const videoLinks = [
                "https://www.youtube.com/embed/Yh9OXmldCIY",  // Introduction to HTML
                "https://www.youtube.com/embed/WnKmbFhENUg",  // HTML Elements
                "https://www.youtube.com/embed/150EzogAp_c",  // Text Formatting
                "https://www.youtube.com/embed/Yh9OXmldCIY",  // Links and Images
                "https://www.youtube.com/embed/150EzogAp_c",  // Lists and Tables
                "https://www.youtube.com/embed/WnKmbFhENUg"   // Forms and Input
            ];

            let player;

            // Initialize YouTube API
            window.onYouTubeIframeAPIReady = function () {
                player = new YT.Player('video-player', {
                    events: {
                        'onStateChange': onPlayerStateChange,
                        'onReady': onPlayerReady
                    }
                });
            };

            function onPlayerReady(event) {
                player = event.target;
                // Start tracking video progress
                setInterval(() => checkVideoProgress(), 1000);
            }

            function updateMarkCompleteButton(progress) {
                const markCompleteBtn = document.querySelector('.flex.justify-between button');
                if (progress >= 90) {
                    markCompleteBtn.disabled = false;
                    markCompleteBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    markCompleteBtn.disabled = true;
                    markCompleteBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }

            function checkVideoProgress() {
                if (player && player.getCurrentTime && player.getDuration) {
                    const currentTime = player.getCurrentTime();
                    const duration = player.getDuration();
                    currentProgress = (currentTime / duration) * 100;
                    
                    updateMarkCompleteButton(currentProgress);
                    localStorage.setItem('currentProgress', currentProgress.toString());
                    
                    // Check for 80% completion to advance to next video
                    if (currentProgress >= 80) {
                        const currentSrc = player.getVideoUrl();
                        const currentIndex = videoLinks.findIndex(link => currentSrc.includes(link));
                        
                        if (currentIndex !== -1) {
                            const currentButton = buttons[currentIndex];
                            markTopicAsCompletedWithIcon(currentButton);
                            
                            // Automatically advance to next video if available
                            if (currentIndex + 1 < buttons.length) {
                                setTimeout(() => {
                                    const nextButton = buttons[currentIndex + 1];
                                    if (!nextButton.disabled) {
                                        // Update video source
                                        const nextVideoSrc = `${videoLinks[currentIndex + 1]}?autoplay=1&enablejsapi=1`;
                                        iframe.src = nextVideoSrc;
                                        
                                        // Update button styles
                                        buttons.forEach(btn => {
                                            btn.classList.remove("bg-blue-600", "text-white");
                                            btn.classList.add("bg-gray-100", "text-gray-700");
                                        });
                                        nextButton.classList.remove("bg-gray-100", "text-gray-700");
                                        nextButton.classList.add("bg-blue-600", "text-white");
                                    }
                                }, 1500); // Wait 1.5 seconds before advancing
                            }
                        }
                    }
                }
            }

            function markTopicAsCompletedWithIcon(button) {
                if (!button.querySelector('.fa-check-circle')) {
                    const topicIndex = Array.from(buttons).indexOf(button);
                    
                    // First ensure button has flex container
                    if (!button.querySelector('.flex.items-center')) {
                        const buttonText = button.textContent.trim();
                        button.innerHTML = `
                            <div class="flex items-center">
                                <span class="flex-1">${buttonText}</span>
                                <i class="fas fa-check-circle ml-2"></i>
                            </div>`;
                    } else if (!button.querySelector('.fa-check-circle')) {
                        button.querySelector('.flex.items-center').insertAdjacentHTML(
                            'beforeend',
                            '<i class="fas fa-check-circle ml-2"></i>'
                        );
                    }
                    
                    markTopicAsCompleted(topicIndex);
                    updateButtonStates();
                    
                    // Unlock next video immediately
                    if (topicIndex + 1 < buttons.length) {
                        const nextButton = buttons[topicIndex + 1];
                        nextButton.disabled = false;
                        nextButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                }
            }

            // Replace the old onPlayerStateChange with this simpler version
            function onPlayerStateChange(event) {
                // We'll handle completion through checkVideoProgress instead
            }

            function markTopicAsCompleted(button) {
                // Remove any existing check icon first
                const existingIcon = button.querySelector('.fa-check-circle');
                if (!existingIcon) {
                    const topicIndex = Array.from(buttons).indexOf(button);
                    markTopicAsCompleted(topicIndex);
                }
            }

            function updateProgressBar(completedCount) {
                const progressBar = document.querySelector(".bg-blue-600");
                const progressText = document.querySelector(".text-gray-500");
                const percentage = (completedCount / buttons.length) * 100;
                progressBar.style.width = `${percentage}%`;
                progressText.textContent = `Progress: ${completedCount}/${buttons.length} Topics`;
            }

            function markTopicAsCompleted(topicIndex) {
                if (!completedTopics.includes(topicIndex)) {
                    completedTopics.push(topicIndex);
                    updateProgressBar(completedTopics.length);
                    saveToLocalStorage();
                }
            }

            function updateButtonStates() {
                buttons.forEach((button, index) => {
                    const isCompleted = completedTopics.includes(index);
                    const isLocked = index > 0 && !completedTopics.includes(index - 1);

                    // Reset button content
                    button.innerHTML = `
                        <div class="flex items-center">
                            <span class="flex-1">${index + 1}. ${button.textContent.split('.')[1] || ''}</span>
                            ${isCompleted ? '<i class="fas fa-check-circle ml-2"></i>' : ''}
                            ${isLocked ? '<i class="fas fa-lock ml-2"></i>' : ''}
                        </div>`;

                    // Update button styles and click behavior
                    if (isLocked) {
                        button.classList.add('opacity-50', 'cursor-not-allowed');
                        button.disabled = true;
                    } else {
                        button.classList.remove('opacity-50', 'cursor-not-allowed');
                        button.disabled = false;
                    }
                });
            }

            buttons.forEach((button, index) => {
                button.addEventListener("click", function () {
                    if (!button.disabled) {
                        // Reset progress and button state for new video
                        currentProgress = 0;
                        currentVideoIndex = index;
                        updateMarkCompleteButton(0);
                        saveToLocalStorage();
                        
                        const videoSrc = `${videoLinks[index]}?autoplay=1&enablejsapi=1`;
                        iframe.src = videoSrc;

                        buttons.forEach(btn => {
                            btn.classList.remove("bg-blue-600", "text-white");
                            btn.classList.add("bg-gray-100", "text-gray-700");
                        });
                        button.classList.remove("bg-gray-100", "text-gray-700");
                        button.classList.add("bg-blue-600", "text-white");
                    }
                });
            });

            function saveToLocalStorage() {
                localStorage.setItem('completedTopics', JSON.stringify(completedTopics));
                localStorage.setItem('currentVideoIndex', currentVideoIndex.toString());
                localStorage.setItem('currentProgress', currentProgress.toString());
            }

            function loadFromLocalStorage() {
                currentVideoIndex = parseInt(localStorage.getItem('currentVideoIndex')) || 0;
                currentProgress = parseFloat(localStorage.getItem('currentProgress')) || 0;
                
                // Load saved video if any
                if (currentVideoIndex > 0) {
                    const videoSrc = `${videoLinks[currentVideoIndex]}?enablejsapi=1`;
                    iframe.src = videoSrc;
                }
                
                // Update progress bar and button states
                updateProgressBar(completedTopics.length);
                updateButtonStates();
                updateMarkCompleteButton(currentProgress);
            }

            // Add this to your existing styles
            const style = document.createElement('style');
            style.textContent = `
                .video-complete-overlay {
                    z-index: 10;
                    animation: fadeIn 0.3s ease-in-out;
                }
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
            `;
            document.head.appendChild(style);

            // Initialize button states
            updateButtonStates();
            
            // Load YouTube API
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

            // Add event listener for "Mark as Complete" button
            const markCompleteBtn = document.querySelector('.flex.justify-between button');
            markCompleteBtn.addEventListener('click', function() {
                const currentButton = document.querySelector("aside button.bg-blue-600");
                if (currentButton) {
                    const currentIndex = Array.from(buttons).indexOf(currentButton);
                    
                    // Mark current topic as completed
                    markTopicAsCompletedWithIcon(currentButton);
                    
                    // Advance to next video if available
                    if (currentIndex + 1 < buttons.length) {
                        const nextButton = buttons[currentIndex + 1];
                        if (!nextButton.disabled) {
                            // Update video source
                            const nextVideoSrc = `${videoLinks[currentIndex + 1]}?autoplay=1&enablejsapi=1`;
                            iframe.src = nextVideoSrc;
                            
                            // Update button styles
                            buttons.forEach(btn => {
                                btn.classList.remove("bg-blue-600", "text-white");
                                btn.classList.add("bg-gray-100", "text-gray-700");
                            });
                            nextButton.classList.remove("bg-gray-100", "text-gray-700");
                            nextButton.classList.add("bg-blue-600", "text-white");
                        }
                    }
                }
            });

            // Load saved progress when page loads
            loadFromLocalStorage();
        });
    </script>
</body>

</html>