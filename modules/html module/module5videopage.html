<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTML Module - 5 | Learning Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="https://ai-public.creatie.ai/gen_page/tailwind-custom.css" rel="stylesheet" />
    <script
        src="https://cdn.tailwindcss.com/3.4.5?plugins=forms@0.5.7,typography@0.5.13,aspect-ratio@0.4.2,container-queries@0.1.1"></script>
    <script src="https://ai-public.creatie.ai/gen_page/tailwind-config.min.js" data-color="#2563EB"
        data-border-radius="small"></script>
</head>

<body class="bg-gray-50 font-[&#39;Inter&#39;]">
    <div class="min-h-screen flex flex-col">
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex">
                        <div class="flex-shrink-0 flex items-center">
                            <img class="h-8 w-auto" src="/images/Red Modern Business Card.png"
                                alt="Logo" />
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-500">Progress: 1/6 Topics</span>
                            <div class="w-32 h-2 bg-gray-200 rounded-full">
                                <div class="w-1/6 h-2 bg-blue-600 rounded-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <div class="flex-1 flex">
            <main class="flex-1 overflow-y-auto bg-white p-8">
                <div class="max-w-8xl mx-auto">
                    <div class="mb-8 flex justify-between items-center">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">HTML Module - 5</h1>
                            <p class="mt-2 text-gray-600">Introduction to HTML basics and fundamentals</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <button id="prevButton" class="!rounded-button px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50">
                                <i class="fas fa-arrow-left mr-2"></i>
                                Previous
                            </button>
                            <button id="nextButton" class="!rounded-button btn-primary px-4 py-2 bg-blue-600 text-white hover:bg-blue-700">
                                Next Module
                                <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold">Getting Started with HTML</h2>
                            <button id="markCompleteBtn" class="!rounded-button px-4 py-2 bg-white text-blue-600 border border-blue-600 hover:bg-blue-50 shadow-sm opacity-50 cursor-not-allowed" disabled>
                                <i class="fas fa-check mr-2"></i>
                                Mark as Complete
                            </button>
                        </div>
                        <div class="aspect-w-16 aspect-h-9 mb-6">
                            <iframe id="video-player" class="rounded-lg" src="https://www.youtube.com/embed/Yh9OXmldCIY?enablejsapi=1" allowfullscreen></iframe>
                        </div>
                        <div class="prose max-w-none">
                            <p>HTML (HyperText Markup Language) is the standard markup language for documents designed to be displayed in a web browser. It defines the structure and layout of a web document.</p>
                            <h3 class="text-lg font-semibold mt-6 mb-3">Key Concepts:</h3>
                            <ul class="list-disc pl-6 space-y-2">
                                <li>HTML Elements and Tags</li>
                                <li>Document Structure</li>
                                <li>Basic Text Formatting</li>
                                <li>Links and Images</li>
                            </ul>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                        <h3 class="text-lg font-semibold mb-4">Assignment - 1</h3>
                        <p class="text-gray-600 mb-6">Create a simple HTML page that includes a heading, paragraph, and an image. Submit your code below.</p>
                        <button class="!rounded-button bg-blue-600 text-white px-6 py-2 font-medium hover:bg-blue-700 transition-colors" onclick="location.href='assignmenntpage.html'">
                            Start Assignment
                        </button>
                    </div>
                </div>
            </main>
            <aside class="w-80 border-l border-gray-200 bg-white overflow-y-auto">
                <div class="p-6">
                    <h2 class="text-lg font-semibold mb-4">Module Topics</h2>
                    <div class="space-y-2">
                        <button class="!rounded-button w-full text-left px-4 py-3 bg-blue-600 text-white">
                            <div class="flex items-center">
                                <span class="flex-1">1. Introduction to HTML</span>
                            </div>
                        </button>
                        <button class="!rounded-button w-full text-left px-4 py-3 bg-gray-100 text-gray-700 hover:bg-blue-50 active:bg-blue-600 active:text-white">
                            2. HTML Elements
                        </button>
                        <button class="!rounded-button w-full text-left px-4 py-3 bg-gray-100 text-gray-700 hover:bg-blue-50">
                            3. Text Formatting
                        </button>
                        <button class="!rounded-button w-full text-left px-4 py-3 bg-gray-100 text-gray-700 hover:bg-blue-50">
                            4. Links and Images
                        </button>
                        <button class="!rounded-button w-full text-left px-4 py-3 bg-gray-100 text-gray-700 hover:bg-blue-50">
                            5. Lists and Tables
                        </button>
                        <button class="!rounded-button w-full text-left px-4 py-3 bg-gray-100 text-gray-700 hover:bg-blue-50">
                            6. Forms and Input
                        </button>
                    </div>
                </div>
            </aside>
            <a href=""></a>
        </div>
        <footer class="bg-white border-t border-gray-200">
            <div class="max-w-8xl mx-auto px-4 py-4 flex items-center justify-between">
                <!-- Remove navigation buttons from footer -->
            </div>
        </footer>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const buttons = document.querySelectorAll("aside button");
            const iframe = document.querySelector("iframe");
            let currentVideoIndex = 0;
            let currentProgress = 0;
            let completedTopics = JSON.parse(localStorage.getItem('completedTopics')) || [];

            const videoLinks = [
                "https://www.youtube.com/embed/Yh9OXmldCIY",  // Introduction to HTML
                "https://www.youtube.com/embed/WnKmbFhENUg",  // HTML Elements
                "https://www.youtube.com/embed/150EzogAp_c",  // Text Formatting
                "https://www.youtube.com/embed/Yh9OXmldCIY",  // Links and Images
                "https://www.youtube.com/embed/150EzogAp_c",  // Lists and Tables
                "https://www.youtube.com/embed/WnKmbFhENUg"   // Forms and Input
            ];

            let player;

            window.onYouTubeIframeAPIReady = function () {
                player = new YT.Player('video-player', {
                    events: {
                        'onStateChange': onPlayerStateChange,
                        'onReady': onPlayerReady
                    }
                });
            };

            function onPlayerReady(event) {
                player = event.target;
                setInterval(() => checkVideoProgress(), 1000);
            }

            function updateMarkCompleteButton(progress) {
                const markCompleteBtn = document.getElementById('markCompleteBtn');
                if (progress >= 80) {
                    markCompleteBtn.disabled = false;
                    markCompleteBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    markCompleteBtn.disabled = true;
                    markCompleteBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }

            function checkVideoProgress() {
                if (player && player.getCurrentTime && player.getDuration) {
                    const currentTime = player.getCurrentTime();
                    const duration = player.getDuration();
                    currentProgress = (currentTime / duration) * 100;
                    updateMarkCompleteButton(currentProgress);
                    localStorage.setItem('currentProgress', currentProgress.toString());
                }
            }

            function markTopicAsCompletedWithIcon(button) {
                if (!button.querySelector('.fa-check-circle')) {
                    const topicIndex = Array.from(buttons).indexOf(button);
                    if (!button.querySelector('.flex.items-center')) {
                        const buttonText = button.textContent.trim();
                        button.innerHTML = `
                            <div class="flex items-center">
                                <span class="flex-1">${buttonText}</span>
                                <i class="fas fa-check-circle ml-2"></i>
                            </div>`;
                    } else if (!button.querySelector('.fa-check-circle')) {
                        button.querySelector('.flex.items-center').insertAdjacentHTML(
                            'beforeend',
                            '<i class="fas fa-check-circle ml-2"></i>'
                        );
                    }
                    
                    markTopicAsCompleted(topicIndex);
                    updateButtonStates();
                    
                    if (topicIndex + 1 < buttons.length) {
                        const nextButton = buttons[topicIndex + 1];
                        nextButton.disabled = false;
                        nextButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                }

                // Check if all topics in module are completed
                const allTopicsCompleted = Array.from(buttons).every(btn => 
                    btn.querySelector('.fa-check-circle')
                );
                
                if (allTopicsCompleted) {
                    markModuleAsCompleted();
                }
            }

            function onPlayerStateChange(event) {
                // We'll handle completion through checkVideoProgress instead
            }

            function updateProgressBar(completedCount) {
                const progressBar = document.querySelector(".bg-blue-600");
                const progressText = document.querySelector(".text-gray-500");
                const percentage = (completedCount / buttons.length) * 100;
                progressBar.style.width = `${percentage}%`;
                progressText.textContent = `Progress: ${completedCount}/${buttons.length} Topics`;
            }

            function markTopicAsCompleted(topicIndex) {
                if (!completedTopics.includes(topicIndex)) {
                    completedTopics.push(topicIndex);
                    updateProgressBar(completedTopics.length);
                    saveToLocalStorage();
                }
            }

            function updateButtonStates() {
                buttons.forEach((button, index) => {
                    const isCompleted = completedTopics.includes(index);
                    const isLocked = index > 0 && !completedTopics.includes(index - 1);

                    button.innerHTML = `
                        <div class="flex items-center">
                            <span class="flex-1">${index + 1}. ${button.textContent.split('.')[1] || ''}</span>
                            ${isCompleted ? '<i class="fas fa-check-circle ml-2"></i>' : ''}
                            ${isLocked ? '<i class="fas fa-lock ml-2"></i>' : ''}
                        </div>`;

                    if (isLocked) {
                        button.classList.add('opacity-50', 'cursor-not-allowed');
                        button.disabled = true;
                    } else {
                        button.classList.remove('opacity-50', 'cursor-not-allowed');
                        button.disabled = false;
                    }
                });
            }

            buttons.forEach((button, index) => {
                button.addEventListener("click", function () {
                    if (!button.disabled) {
                        currentProgress = 0;
                        currentVideoIndex = index;
                        updateMarkCompleteButton(0);
                        saveToLocalStorage();
                        
                        const videoSrc = `${videoLinks[index]}?autoplay=1&enablejsapi=1`;
                        iframe.src = videoSrc;

                        buttons.forEach(btn => {
                            btn.classList.remove("bg-blue-600", "text-white");
                            btn.classList.add("bg-gray-100", "text-gray-700");
                        });
                        button.classList.remove("bg-gray-100", "text-gray-700");
                        button.classList.add("bg-blue-600", "text-white");
                    }
                });
            });

            function saveToLocalStorage() {
                localStorage.setItem('completedTopics', JSON.stringify(completedTopics));
                localStorage.setItem('currentVideoIndex', currentVideoIndex.toString());
                localStorage.setItem('currentProgress', currentProgress.toString());
            }

            function loadFromLocalStorage() {
                currentVideoIndex = parseInt(localStorage.getItem('currentVideoIndex')) || 0;
                currentProgress = parseFloat(localStorage.getItem('currentProgress')) || 0;
                
                if (currentVideoIndex > 0) {
                    const videoSrc = `${videoLinks[currentVideoIndex]}?enablejsapi=1`;
                    iframe.src = videoSrc;
                }
                
                updateProgressBar(completedTopics.length);
                updateButtonStates();
                updateMarkCompleteButton(currentProgress);
            }

            const style = document.createElement('style');
            style.textContent = `
                .video-complete-overlay {
                    z-index: 10;
                    animation: fadeIn 0.3s ease-in-out;
                }
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
            `;
            document.head.appendChild(style);

            updateButtonStates();
            
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

            const markCompleteBtn = document.getElementById('markCompleteBtn');
            markCompleteBtn.addEventListener('click', function() {
                const currentButton = document.querySelector("aside button.bg-blue-600");
                if (currentProgress >= 80 && currentButton) {
                    const currentIndex = Array.from(buttons).indexOf(currentButton);
                    markTopicAsCompletedWithIcon(currentButton);
                    
                    if (currentIndex + 1 < buttons.length) {
                        const nextButton = buttons[currentIndex + 1];
                        if (!nextButton.disabled) {
                            nextButton.click();
                        }
                    }
                }
            });

            const prevButton = document.getElementById('prevButton');
            prevButton.addEventListener('click', function() {
                const currentButton = document.querySelector("aside button.bg-blue-600");
                if (currentButton) {
                    const currentIndex = Array.from(buttons).indexOf(currentButton);
                    if (currentIndex > 0) {
                        currentVideoIndex = currentIndex - 1;
                        buttons[currentVideoIndex].click();
                    } else {
                        location.href = '../main pages/modulespagehtml.html';
                    }
                } else {
                    location.href = '../main pages/modulespagehtml.html';
                }
            });

            loadFromLocalStorage();
        });

        function markModuleAsCompleted() {
            const completedModules = JSON.parse(localStorage.getItem('completedModules')) || [];
            const currentModule = parseInt(new URLSearchParams(window.location.search).get('module') || '0');
            
            if (!completedModules.includes(currentModule)) {
                completedModules.push(currentModule);
                localStorage.setItem('completedModules', JSON.stringify(completedModules));
                
                // Add completion UI feedback
                showCompletionMessage();
            }
        }

        function showCompletionMessage() {
            const message = document.createElement('div');
            message.className = 'fixed top-4 right-4 bg-green-100 text-green-800 px-6 py-3 rounded-lg shadow-lg';
            message.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                    <span>Module completed! Ready for next module.</span>
                </div>
            `;
            document.body.appendChild(message);
            setTimeout(() => message.remove(), 3000);
        }

        // Update next button click handler
        const nextButton = document.getElementById('nextButton');
        nextButton.addEventListener('click', function() {
            const completedTopics = JSON.parse(localStorage.getItem('completedTopics')) || [];
            const completedModules = JSON.parse(localStorage.getItem('completedModules')) || [];
            const currentModule = parseInt(new URLSearchParams(window.location.search).get('module') || '0');
            
            if (completedTopics.length === 6) { // All topics in current module completed
                // Mark current module as completed
                if (!completedModules.includes(currentModule)) {
                    completedModules.push(currentModule);
                    localStorage.setItem('completedModules', JSON.stringify(completedModules));
                }
                
                // Navigate to next module
                const nextModule = currentModule + 1;
                window.location.href = `module${nextModule + 1}videopage.html?module=${nextModule}`;
            } else {
                // Show warning message
                const warningMessage = document.createElement('div');
                warningMessage.className = 'fixed top-4 right-4 bg-yellow-100 text-yellow-800 px-6 py-3 rounded-lg shadow-lg';
                warningMessage.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                        <span>Please complete all topics in this module first</span>
                    </div>
                `;
                document.body.appendChild(warningMessage);
                setTimeout(() => warningMessage.remove(), 3000);
            }
        });

        // Remove duplicate event listeners for btn-primary
        // Remove these lines:
        // document.querySelector('button.btn-primary').addEventListener...
        // The duplicate event listener for btn-primary

        function checkModuleCompletion() {
            const allTopicsCompleted = completedTopics.length === 6; // All 6 topics must be completed
            
            if (allTopicsCompleted) {
                markModuleAsCompleted();
                
                // Show completion message and enable next module button
                const completionMessage = document.createElement('div');
                completionMessage.className = 'bg-green-100 text-green-800 p-4 rounded-lg mb-4';
                completionMessage.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>Module completed! You can now proceed to Module 2.</span>
                    </div>
                `;
                document.querySelector('.main-content').insertBefore(
                    completionMessage,
                    document.querySelector('.bg-white.rounded-lg')
                );
            }
        }

        // Update markTopicAsCompletedWithIcon function
        function markTopicAsCompletedWithIcon(button) {
            // ...existing code...
            
            // Check module completion after marking topic
            checkModuleCompletion();
        }

        // Update navigation to next module
        document.querySelector('button.btn-primary').addEventListener('click', function() {
            const completedModules = JSON.parse(localStorage.getItem('completedModules')) || [];
            const currentModule = 0; // Module 1 index
            
            if (completedModules.includes(currentModule)) {
                window.location.href = '.../main pages/modulespagehtml.html';
            } else {
                alert('Please complete all topics in this module first.');
            }
        });

        document.querySelector('button.btn-primary').addEventListener('click', function() {
            const completedModules = JSON.parse(localStorage.getItem('completedModules')) || [];
            const currentModule = 0; // Module 1 index
            
            if (completedModules.includes(currentModule)) {
                window.location.href = '../main pages/modulespagehtml.html';
            } else {
                alert('Please complete all topics in this module first.');
            }
        });
    </script>
</body>
</html>